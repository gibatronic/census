#!/usr/bin/env node

var getUserRepositories = require('../lib/get-user-repositories');
var yargs = require('yargs');

var census = function(repositories) {
  // @todo get information from each given repository
};

var error = function(exception) {
  process.stderr.write(exception.toString().trim() + '\n');
};

var help = function() {
  var message = [
    '',
    '  Usage:',
    '    census [options] [owner/repo]',
    '',
    '  Options:',
    '    -h, --help     print usage information',
    '    -v, --version  print census version',
    '',
    ''
  ].join('\n');

  process.stderr.write(message);
};

var main = function(argv) {
  var argv = yargs.alias('h', 'help')
                  .alias('v', 'version')
                  .boolean('h')
                  .boolean('v')
                  .parse(argv);

  if (argv.help) {
    return help();
  }

  if (argv.version) {
    return version();
  }

  var repositories = argv._;

  if (repositories.length == 0) {
    try {
      repositories = getUserRepositories();
    } catch (exception) {
      return error(exception);
    }
  }

  return census(repositories);
};

var version = function() {
  process.stderr.write('v' + require('../package').version + '\n');
};

if (require.main != module) {
  return;
}

main(process.argv.slice(2));
